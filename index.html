<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BulkSMS Basic</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #fffbf5;
            --bg-card: #fff7ed;
            --bg-input: #fef3e2;
            --text: #1c1917;
            --text-secondary: #78716c;
            --accent: #ea580c;
            --accent-light: #ffedd5;
            --success: #16a34a;
            --border: #fed7aa;
        }

        .dark {
            --bg: #1c1917;
            --bg-card: #292524;
            --bg-input: #44403c;
            --text: #fafaf9;
            --text-secondary: #a8a29e;
            --accent: #fb923c;
            --accent-light: rgba(251, 146, 60, 0.2);
            --border: #44403c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            padding: 16px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            padding: 24px 0;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .header p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .badge {
            display: inline-block;
            background: var(--accent-light);
            color: var(--accent);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title i { color: var(--accent); }

        .form-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: block;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-family: inherit;
            font-size: 16px;
            margin-bottom: 12px;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-textarea { min-height: 80px; resize: vertical; }

        .form-hint {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: -8px;
            margin-bottom: 12px;
        }

        .placeholder-btn {
            display: inline-block;
            background: var(--accent-light);
            color: var(--accent);
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .placeholder-btn:active { opacity: 0.8; }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text);
            margin-top: 10px;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .contact-count {
            text-align: center;
            padding: 20px;
            background: var(--accent-light);
            border-radius: 10px;
            margin-bottom: 12px;
        }

        .contact-count .number {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent);
        }

        .contact-count .label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-input);
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .progress-info span {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .progress-info strong {
            color: var(--accent);
        }

        .current-contact {
            background: var(--accent-light);
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            text-align: center;
        }

        .current-contact .name {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .current-contact .phone {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .message-preview {
            background: var(--bg-input);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.5;
            border-left: 3px solid var(--accent);
        }

        .nav-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 12px;
        }

        .nav-buttons .btn { width: 100%; }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 12px;
        }

        .upload-area:active { border-color: var(--accent); }

        .upload-area i {
            font-size: 28px;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .upload-area p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .contact-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .contact-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg-input);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .contact-item .name { font-weight: 500; }
        .contact-item .phone { color: var(--text-secondary); font-size: 12px; }

        .contact-item button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 4px;
        }

        .step { display: none; }
        .step.active { display: block; }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--border);
        }

        .step-dot.active { background: var(--accent); }
        .step-dot.done { background: var(--success); }

        .manual-add {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 8px;
        }

        .done-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .done-screen i {
            font-size: 60px;
            color: var(--success);
            margin-bottom: 16px;
        }

        .done-screen h2 {
            font-size: 22px;
            margin-bottom: 8px;
        }

        .done-screen p {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }
    </style>
</head>
<body>
    <header class="header">
        <h1><i class="fas fa-sms"></i> BulkSMS Basic</h1>
        <p>Send personalized SMS using your phone</p>
        <span class="badge">FREE - No API needed</span>
    </header>

    <div class="step-indicator">
        <div class="step-dot active" id="dot1"></div>
        <div class="step-dot" id="dot2"></div>
        <div class="step-dot" id="dot3"></div>
        <div class="step-dot" id="dot4"></div>
    </div>

    <!-- Step 1: Add Contacts -->
    <div class="step active" id="step1">
        <div class="card">
            <h3 class="card-title"><i class="fas fa-users"></i> Add Contacts</h3>

            <div class="upload-area" id="uploadArea">
                <i class="fas fa-file-csv"></i>
                <p>Tap to upload CSV file<br><small>Format: Name, Phone</small></p>
            </div>
            <input type="file" id="fileInput" accept=".csv,.txt" hidden>

            <p style="text-align: center; color: var(--text-secondary); font-size: 12px; margin: 12px 0;">— OR —</p>

            <div class="manual-add">
                <input type="text" class="form-input" id="manualName" placeholder="Name" style="margin-bottom: 0;">
                <input type="tel" class="form-input" id="manualPhone" placeholder="Phone" style="margin-bottom: 0;">
            </div>
            <button class="btn btn-secondary" id="addContact"><i class="fas fa-plus"></i> Add Contact</button>
        </div>

        <div class="card">
            <div class="contact-count">
                <div class="number" id="contactCount">0</div>
                <div class="label">CONTACTS ADDED</div>
            </div>
            <div class="contact-list" id="contactList"></div>
            <button class="btn btn-secondary" id="clearAll" style="display: none;"><i class="fas fa-trash"></i> Clear All</button>
        </div>

        <button class="btn btn-primary" id="toStep2" disabled><i class="fas fa-arrow-right"></i> Next: Write Message</button>
    </div>

    <!-- Step 2: Write Message -->
    <div class="step" id="step2">
        <div class="card">
            <h3 class="card-title"><i class="fas fa-pen"></i> Write Your Message</h3>

            <label class="form-label">Message Template</label>
            <textarea class="form-textarea" id="messageTemplate" placeholder="Hi {name}, just wanted to reach out..."></textarea>

            <p class="form-hint">Tap to insert placeholder:</p>
            <button class="placeholder-btn" data-ph="{name}"><i class="fas fa-user"></i> {name}</button>
            <button class="placeholder-btn" data-ph="{phone}"><i class="fas fa-phone"></i> {phone}</button>

            <div class="message-preview" id="previewBox" style="display: none;">
                <strong style="font-size: 11px; color: var(--text-secondary);">PREVIEW:</strong><br>
                <span id="previewText"></span>
            </div>
        </div>

        <div class="nav-buttons">
            <button class="btn btn-secondary" id="backToStep1"><i class="fas fa-arrow-left"></i> Back</button>
            <button class="btn btn-primary" id="toStep3" disabled><i class="fas fa-arrow-right"></i> Start Sending</button>
        </div>
    </div>

    <!-- Step 3: Send Messages -->
    <div class="step" id="step3">
        <div class="card">
            <h3 class="card-title"><i class="fas fa-paper-plane"></i> Send Messages</h3>

            <div class="progress-info">
                <span>Progress:</span>
                <strong><span id="currentIndex">1</span> of <span id="totalCount">0</span></strong>
            </div>

            <div class="current-contact">
                <div class="name" id="currentName">John Doe</div>
                <div class="phone" id="currentPhone">0412 345 678</div>
            </div>

            <div class="message-preview" id="currentMessage"></div>

            <button class="btn btn-success" id="sendBtn"><i class="fas fa-sms"></i> Open SMS App to Send</button>

            <div class="nav-buttons">
                <button class="btn btn-secondary" id="skipBtn"><i class="fas fa-forward"></i> Skip</button>
                <button class="btn btn-primary" id="nextBtn"><i class="fas fa-check"></i> Mark Sent & Next</button>
            </div>
        </div>

        <button class="btn btn-secondary" id="pauseBtn"><i class="fas fa-pause"></i> Pause & Save Progress</button>
    </div>

    <!-- Step 4: Done -->
    <div class="step" id="step4">
        <div class="done-screen">
            <i class="fas fa-check-circle"></i>
            <h2>All Done!</h2>
            <p>You've sent messages to <strong id="sentCount">0</strong> contacts</p>
            <button class="btn btn-primary" id="startOver"><i class="fas fa-redo"></i> Start Over</button>
        </div>
    </div>

    <script>
        // Theme detection
        if (window.matchMedia?.('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
            document.documentElement.classList.toggle('dark', e.matches);
        });

        // State
        let contacts = [];
        let currentStep = 1;
        let currentContactIndex = 0;
        let sentCount = 0;
        let messageTemplate = '';

        // Elements
        const $ = id => document.getElementById(id);

        // Step navigation
        function showStep(step) {
            currentStep = step;
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            $(`step${step}`).classList.add('active');

            document.querySelectorAll('.step-dot').forEach((d, i) => {
                d.classList.remove('active', 'done');
                if (i + 1 < step) d.classList.add('done');
                if (i + 1 === step) d.classList.add('active');
            });
        }

        // File upload
        $('uploadArea').onclick = () => $('fileInput').click();
        $('fileInput').onchange = e => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = ev => {
                const lines = ev.target.result.split('\n').filter(l => l.trim());
                let added = 0;
                lines.forEach(line => {
                    const parts = line.split(/[,\t]/);
                    const name = (parts[0] || '').trim().replace(/["']/g, '');
                    let phone = (parts[1] || '').trim().replace(/["']/g, '').replace(/\D/g, '');
                    if (phone.startsWith('61')) phone = '0' + phone.slice(2);

                    if (phone && !contacts.find(c => c.phone === phone)) {
                        contacts.push({ name: name || 'Unknown', phone, sent: false });
                        added++;
                    }
                });
                updateContactList();
            };
            reader.readAsText(file);
        };

        // Manual add
        $('addContact').onclick = () => {
            const name = $('manualName').value.trim();
            let phone = $('manualPhone').value.trim().replace(/\D/g, '');
            if (phone.startsWith('61')) phone = '0' + phone.slice(2);

            if (!phone) return;
            if (contacts.find(c => c.phone === phone)) return;

            contacts.push({ name: name || 'Unknown', phone, sent: false });
            $('manualName').value = '';
            $('manualPhone').value = '';
            updateContactList();
        };

        $('manualPhone').onkeypress = e => { if (e.key === 'Enter') $('addContact').click(); };

        function updateContactList() {
            $('contactCount').textContent = contacts.length;
            $('toStep2').disabled = contacts.length === 0;
            $('clearAll').style.display = contacts.length > 0 ? 'flex' : 'none';

            $('contactList').innerHTML = contacts.slice(0, 50).map((c, i) => `
                <div class="contact-item">
                    <div>
                        <div class="name">${escHtml(c.name)}</div>
                        <div class="phone">${escHtml(c.phone)}</div>
                    </div>
                    <button onclick="removeContact(${i})"><i class="fas fa-times"></i></button>
                </div>
            `).join('') + (contacts.length > 50 ? `<p style="text-align:center;color:var(--text-secondary);font-size:12px;">+ ${contacts.length - 50} more</p>` : '');
        }

        window.removeContact = i => { contacts.splice(i, 1); updateContactList(); };
        $('clearAll').onclick = () => { contacts = []; updateContactList(); };

        // Step navigation buttons
        $('toStep2').onclick = () => showStep(2);
        $('backToStep1').onclick = () => showStep(1);

        // Message template
        $('messageTemplate').oninput = updatePreview;
        document.querySelectorAll('.placeholder-btn').forEach(btn => {
            btn.onclick = () => {
                const ta = $('messageTemplate');
                const ph = btn.dataset.ph;
                const start = ta.selectionStart;
                ta.value = ta.value.slice(0, start) + ph + ta.value.slice(ta.selectionEnd);
                ta.focus();
                ta.setSelectionRange(start + ph.length, start + ph.length);
                updatePreview();
            };
        });

        function updatePreview() {
            messageTemplate = $('messageTemplate').value;
            $('toStep3').disabled = !messageTemplate.trim();

            if (messageTemplate && contacts.length > 0) {
                const sample = contacts[0];
                $('previewText').textContent = messageTemplate
                    .replace(/{name}/g, sample.name)
                    .replace(/{phone}/g, sample.phone);
                $('previewBox').style.display = 'block';
            } else {
                $('previewBox').style.display = 'none';
            }
        }

        // Start sending
        $('toStep3').onclick = () => {
            currentContactIndex = contacts.findIndex(c => !c.sent);
            if (currentContactIndex === -1) currentContactIndex = 0;
            sentCount = contacts.filter(c => c.sent).length;
            showStep(3);
            showCurrentContact();
        };

        function showCurrentContact() {
            const remaining = contacts.filter(c => !c.sent);
            if (remaining.length === 0) {
                $('sentCount').textContent = sentCount;
                showStep(4);
                return;
            }

            // Find next unsent contact
            while (currentContactIndex < contacts.length && contacts[currentContactIndex].sent) {
                currentContactIndex++;
            }
            if (currentContactIndex >= contacts.length) {
                $('sentCount').textContent = sentCount;
                showStep(4);
                return;
            }

            const contact = contacts[currentContactIndex];
            const unsent = contacts.filter(c => !c.sent);
            const unsentIndex = unsent.indexOf(contact) + 1;

            $('currentIndex').textContent = unsentIndex;
            $('totalCount').textContent = unsent.length;
            $('currentName').textContent = contact.name;
            $('currentPhone').textContent = formatPhone(contact.phone);

            const msg = messageTemplate
                .replace(/{name}/g, contact.name)
                .replace(/{phone}/g, contact.phone);
            $('currentMessage').textContent = msg;
        }

        function formatPhone(p) {
            if (p.length === 10) return p.slice(0,4) + ' ' + p.slice(4,7) + ' ' + p.slice(7);
            return p;
        }

        // Send button - opens SMS app
        $('sendBtn').onclick = () => {
            const contact = contacts[currentContactIndex];
            const msg = messageTemplate
                .replace(/{name}/g, contact.name)
                .replace(/{phone}/g, contact.phone);

            // Open native SMS app
            window.location.href = `sms:${contact.phone}?body=${encodeURIComponent(msg)}`;
        };

        // Mark sent & next
        $('nextBtn').onclick = () => {
            contacts[currentContactIndex].sent = true;
            sentCount++;
            currentContactIndex++;
            showCurrentContact();
        };

        // Skip
        $('skipBtn').onclick = () => {
            currentContactIndex++;
            showCurrentContact();
        };

        // Pause
        $('pauseBtn').onclick = () => {
            showStep(1);
        };

        // Start over
        $('startOver').onclick = () => {
            contacts = [];
            currentContactIndex = 0;
            sentCount = 0;
            messageTemplate = '';
            $('messageTemplate').value = '';
            updateContactList();
            updatePreview();
            showStep(1);
        };

        function escHtml(t) {
            const d = document.createElement('div');
            d.textContent = t;
            return d.innerHTML;
        }

        // Initialize
        updateContactList();
    </script>
</body>
</html>
